define(function(require,t){var a=require("swiper"),r=require("weui");require("jquery.lazyload");var n=function(e,t){s=t.sysinfo.gets.s,g=t.sysinfo.gets.g,$.post(t.url("m/getName"),{s:s,g:g}).then(function(a){if(0!=a.errno)return r.alert(a.message),void e(!1);var n=!1===a.data.name,i=a.data.account_qrcode_link;if(n)var l='<div class="swiper-container" style="height:100%">                    <div class="tag clearfix">                        <span class="slide-to" tabindex="0">排行榜Top100</span>                        <span class="slide-to" tabindex="1">活动规则</span>                        <span class="slide-to" tabindex="2">关注我们</span>                    </div>                    <div class="swiper-wrapper" style="padding-bottom:8rem">                        <div class="swiper-slide swiper-rank">                            <table class="table rank-list"></table>                        </div>                        <div class="swiper-slide swiper-rule">                            <div class="rule"></div>                        </div>                        <div class="swiper-slide swiper-call-us">                        </div>                    </div>                </div>                <a href="javascript:;" class="fix back-home">返回首页</a>';else l='<div class="swiper-container" style="height:100%">                    <div class="tag clearfix">                        <span class="slide-to" tabindex="0">排行榜Top100</span>                        <span class="slide-to" tabindex="1">活动规则</span>                        <span class="slide-to" tabindex="2"><span>'+a.data.name+'</span>收到的礼物</span>                    </div>                    <div class="swiper-wrapper" style="padding-bottom:8rem">                        <div class="swiper-slide swiper-rank">                            <table class="table rank-list"></table>                        </div>                        <div class="swiper-slide swiper-rule">                            <div class="rule"></div>                        </div>                        <div class="swiper-slide swiper-rewardto">                            <ul class="rewardto-list"></ul>                        </div>                    </div>                </div>                <a href="javascript:;" class="fix back-home">返回首页</a>';if(document.querySelector("#app").innerHTML=l,!n){var c={title:a.data.share.title,desc:a.data.share.desc,imgUrl:a.data.share.imgUrl,link:a.data.share.link,done:function(){$.get(a.data.share.done_url)}};t.wx.shareMessage(c),t.wx.shareTimeline(c)}o(t,s,g,n,i),e()})},i=function(e){var t=typeof e;return"object"!=t?t:(t=Object.prototype.toString.call(e),t.slice(8,-1).toLowerCase())},l=function(e){try{return null===e.offsetParent}catch(e){return!1}},c=function(e,t,a){function r(){var e=Math.abs(s.offset().top+s.height()-$(parent.parent).scrollTop()- -n.offset)<window.innerHeight;e&&!o&&(o=!0,s.html('<i class="fas fa-spinner fa-spin"></i> 正在加载中'),n.callback&&n.callback(function(e){e?s.text("没有更多数据了"):(s.text("上拉加载更多"),o=!1)},l(n.parent)))}var n={selector:null,parent:window,callback:function(e){},offset:5};n="object"==i(e)?$.extend({},n,e):$.extend({},n,{selector:e,callback:t,offset:a});var s=$("<p>").addClass("text-center load-more").text("上拉加载更多"),c=$(n.selector),o=!1;return c.append(s),$(n.parent).on("scroll",r),l($(n.parent)[0])||r(),{run:r}},o=function(e,t,n,s,i){var l=!0,o=!0,d=!0;document.querySelector(".back-home").href=e.url("p/index",{s:t,g:n});var u=function(){if(!l)return!0;var a=e.loading(".swiper-rank");$.post(e.url("m/getRank"),{s:t}).then(function(e){if(0!=e.errno)return a.hide(function(){r.alert(e.message)}),!1;var t="";if(document.querySelector(".rank-list").innerHTML="",e.data.length>0)for(var n in e.data){var s=e.data[n],i=+n+1;t+='<tr><td class="text-center"><span class="rank">'+i+'</span></td><td><div class="avatar" data-src="'+s.avatar+'" style="background-image:url(data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=)"></div></td><td>'+s.name+'</td><td>赞个数:<span class="lighthigh">'+s.gift_score+'</span></td><td>已收到:<span class="lighthigh">￥'+s.gift_amount+"</span></td></tr>"}else t+='<tr><td class="text-center" colspan="5" style="line-height:20rem">暂无数据</td></tr>';a.hide(function(){l=!1,document.querySelector(".rank-list").innerHTML=t,$(".swiper-rank [data-src]").lazyload()})}).fail(function(){a.hide(function(){r.alert("服务器繁忙，请稍后再试")})})},p=function(){if(!o)return!0;var a=e.loading(".swiper-rule");$.post(e.url("m/getRule"),{s:t}).then(function(e){if(0!=e.errno)return a.hide(function(){document.querySelector(".rule").style.textAlign="center",document.querySelector(".rule").style.lineHeight="30rem",document.querySelector(".rule").innerHTML=e.message}),!1;var t=e.data;a.hide(function(){o=!1,document.querySelector(".rule").style.textAlign="unset",document.querySelector(".rule").style.lineHeight="unset",document.querySelector(".rule").innerHTML=t})}).fail(function(){a.hide(function(){document.querySelector(".rule").innerHTML="服务器繁忙，请稍后再试",document.querySelector(".rule").style.textAlign="center",document.querySelector(".rule").style.lineHeight="30rem"})})},f=function(){if(s){var a='<p class="text-center"><img src="'+i+'" style="width:80%"/></p><p class="text-center">长按识别关注公众号</p>';document.querySelector(".swiper-call-us").innerHTML+=a}else{if(!d)return!0;d=!1;var r=1,l=10;c(".swiper-rewardto",function(a){$.post(e.url("m/getRewardto"),{s:t,g:n,page:r,size:l}).then(function(e){if(0!=e.errno)return a(!0),!1;var t="";for(var r in e.data){var n=e.data[r];t+='<li class="clearfix">'+n.name+"送出礼物【"+n.gift_name+"】*"+n.gift_total+'<span class="rewardto-time">'+n.rewardto_time+"</span></li>"}document.querySelector(".rewardto-list").innerHTML+=t,e.data.length<l?a(!0):a()}).fail(function(){a(!0)})},30)}},v=function(e){switch(document.querySelectorAll(".slide-to").forEach(function(e){e.className="slide-to"}),document.querySelector('.slide-to[tabindex="'+e+'"]').className="slide-to on",e){case 0:u();break;case 1:p();break;case 2:f()}},g=new a(".swiper-container",{on:{transitionEnd:function(){v(this.activeIndex)}}});v(g.activeIndex),document.querySelectorAll(".slide-to").forEach(function(e){e.addEventListener("click",function(e){var t=e.target.getAttribute("tabindex");v(t),g.slideTo(t,500)})})};t.run=n});