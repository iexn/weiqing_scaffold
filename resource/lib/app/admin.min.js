define(function(require,t){var i=require("vue"),a=require("vue-resource"),n=require("jquery"),o=require("util");i.use(a),i.http.options.emulateJSON=!0;var l=window.sysinfo,s=function(e){for(var t=/[0-9]{0,3}/g,i=e.match(t),a="#",n=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F"],o=0;o<i.length;o++){for(var l=null,s=i[o],r=s,d=[];s>16;)l=s%16,s=s/16>>0,d.push(n[l]);d.push(n[s]),r<16&&""!=r&&d.push(0),a+=d.reverse().join("")}return a},r=function(e){return"object"!=typeof e?typeof e:Object.prototype.toString.call(e).slice(8,-1).toLowerCase()},d=function(e){var t=document.createElement("canvas");t.width=e.width,t.height=e.height;var i=t.getContext("2d");i.drawImage(e,0,0,e.width,e.height);var a=t.toDataURL("image/png");return a},c=function(e,t){var i=new Image;i.src=n(e).prop(t||"src"),i.onload=function(){n(e).prop("src",d(this))}},u=function(e){try{JSON.parse(e)}catch(e){return!1}return!0},p=null,m=function(e,t){if(clearTimeout(p),t=t||0,0==t)return n("#pageTip").remove(),!0;p=setTimeout(function(){n("#pageTip").remove(),e&&e()},t+300)},h=function(e,t,i){if(m(function(){i&&i(t)}),t){var a='                <div id="pageTip" class="modal fade modal-success" tabindex="-1" role="dialog" aria-hidden="true" style="display: block; padding-right: 17px;">                    <div class="modal-dialog we7-modal-dialog">                        <div class="modal-content">                            <div class="modal-body">                                <div class="text-center">                                    <i class="text-success wi wi-success-sign"></i>'+e+'                                         </div>                                          <div class="clearfix"></div>                            </div>                          </div>                    </div>                </div>            ';n("body").append(a)}else{a='                <div id="pageTip" class="modal fade modal-success" tabindex="-1" role="dialog" aria-hidden="true" style="display: block; padding-right: 17px;">                    <div class="modal-dialog we7-modal-dialog">                        <div class="modal-content" style="background-color:#a94442;border-color:#a94442">                            <div class="modal-body">                                <div class="text-center">                                    <i class="text-error wi wi-error-sign"></i>'+e+'                                         </div>                                          <div class="clearfix"></div>                            </div>                          </div>                    </div>                </div>            ';n("body").append(a)}setTimeout(function(){n("#pageTip").addClass("in")},1),m(function(){i&&i(t)},2e3)};n(".check-all-control").on("click",function(){for(var e=n(".check-all"),t=e.length,i=0;i<t;i++)if(!n(e[i]).prop("checked"))return void e.prop("checked",!0);e.prop("checked",!1)}),n(".limithigh").each(function(e,t){var i=this;if(n(this).height()<=180)return!1;n(this).css({height:120,overflow:"hidden",position:"relative"});var a=n("<div>").css({position:"absolute",bottom:"0",left:"0","z-index":"999",width:"100%",height:"80","text-align":"center","background-image":"linear-gradient(-180deg,rgba(255,255,255,0) 0%,#fff 70%)"}),o=n("<a>").prop("href","javascript:;").css({display:"inline-block","margin-top":"60px",color:"#ca0c16","font-size":"14px","text-decoration":"underline"}).text("点击显示全部").on("click",function(){n(i).css("height","auto"),a.hide()});a.append(o),n(this).append(a)});var v=function(){n("#tabtop").append('<li role="presentation"><a href="#extend" aria-controls="extend" role="tab" data-toggle="tab">扩展设置</a></li>'),n("#tabbody").append('<div role="tabpanel" class="tab-pane" id="extend">            <div class="form-group">                <label class="col-md-2 control-label text-right">页底标注文字：</label>                <div class="col-md-10">                    <input type="text" class="form-control" name="support_name" value="'+y+'">                    <p class="help-block">                        1. 实际文字显示建议15个字以内；<br>                        2. 添加超链接请输入英文符号： [link:链接文字](链接地址)，如： [link:百度一下，你就知道](https://www.baidu.com)； <br>                        3. 添加电话拨打功能请输入英文符号： [tel:电话文字](电话号)，如： [tel:中国移动](10086) <br>                        4. 文字显示请勿连续显示英文符号 []() 以及括号内的内容，它会被视为上述规则被直接替换 <br>                    </p>                </div>            </div>        </div>        ')},f=n("#tabtop li").eq(1),g=n("#tabtop li").eq(0),b=null,y=n("#tabtop").attr("data-support-name");f.on("dblclick",function(){g.on("mousedown",function(){clearTimeout(b),b=setTimeout(function(){v()},1e3)}),g.on("mouseup",function(){clearTimeout(b)}),b=setTimeout(function(){g.off("dblclick"),g.off("mousedown"),g.off("mouseup"),clearTimeout(b)},600)}),v(),n("#form_search").on("submit",function(){if("get"!=n(this).prop("method"))return!0;var e=window.location.protocol,t=window.location.host,i=window.location.pathname,a=window.location.search,o=window.location.hash,l=n(this).serializeArray(),s={};for(key in a.substr(1).split("&").forEach(function(e){e=e.split("="),s[e[0]]=e[1]}),l.forEach(function(e){s[e.name]=e.value}),a=[],s)a.push(key+"="+s[key]);a="?"+a.join("&");var r=e+"//"+t+i+a+o;return location.href=r,!1});var x=function(e,t,i){var a=e||"",n=[];for(var o in t)n.push(o+"="+encodeURI(t[o]));return a+="?"+n.join("&"),void 0!==i&&(a+="#"+i),a},w=function(e,t,i,a){var o=l.siteroot.slice(0,-1),s=(a||o)+"/app/index.php",r={i:l.acid,c:"entry",do:e,m:l.module.name};return t=t||{},e.indexOf("/")>-1?(e=e.split("/"),e[0].length>0&&(t.do=e[0]),e[1].length>0&&(t.et=e[1])):t.et=e,r=n.extend({},r,t),x(s,r,i)},_=function(e,t,i){var a="./index.php";t=t||{};var o={c:"site",a:"entry",m:l.module.name,do:l.controller_name,et:l.action_name,version_id:0};return e.indexOf("/")>-1?(e=e.split("/"),e[0].length>0&&(t.do=e[0]),e[1].length>0&&(t.et=e[1])):t.et=e,o=n.extend({},o,t),x(a,o,i)},k=function(e){var t=e.innerHTML;return e.disabled=!0,e.innerHTML='<i class="fas fa-spinner fa-spin"></i> '+t,{hide:function(i){e.disabled=!1,e.innerHTML=t,i&&i()}}};i.component("util-image",{props:["name","value","multiple"],data:function(){if(void 0===this.value)var e=[];else if(""==this.value)e=[];else e=this.value.split(",");return{values:e,open_value:this.value}},watch:{open_value:function(e){this.$emit("value",e)},value:function(e){if(void 0===this.value)var t=[];else if("string"==r(this.value))if(""==this.value)t=[];else t=this.value.split(",");else if("array"==r(this.value))t=this.value;else t=[];this.values=t},values:function(e){this.$emit("value",this.value_str)}},methods:{showImageDialog:function(e){var t=this,i=n(e.target),a=i.parent().prev(),l=a.val();a.parent().next().children();o.image(l,function(e){if("[object Array]"!==Object.prototype.toString.call(e))t.values.length=0,t.values.push(e.attachment||e.media_id);else for(var i in e)t.values.push(e[i].attachment||e[i].media_id)},{global:!1,class_extra:"",direct:!0,multiple:this.multiple||!1,fileSizeLimit:512e4})},deleteImage:function(e){this.values.splice(e,1)}},filters:{tomedia:function(e){return o.tomedia(e)}},computed:{value_str:function(){return this.values.join(",")}},template:'            <div>                <div class="input-group">                    <input type="text" :name="name" :value="value_str" class="form-control" autocomplete="off">                    <span class="input-group-btn">                        <button class="btn btn-default" type="button" @click="showImageDialog">选择图片</button>                    </span>                </div>                <div class="input-group" style="margin-top:.5em;">                    <span style="position: relative;display:inline-block;margin:0 20px" v-if="values.length == 0">                        <img src="./resource/images/nopic.jpg" onerror="this.src=\'./resource/images/nopic.jpg\'; this.title=\'图片未找到.\'" width="150" class="img-responsive img-thumbnail" title="图片未找到.">                        <em title="删除这张图片" class="close" style="position: absolute; top: 0; right: -14px;">×</em>                    </span>                    <span v-for="(v, index) in values" style="position:relative;display:inline-block;margin:0 20px">                        <img :src="v|tomedia" onerror="this.src=\'./resource/images/nopic.jpg\'; this.title=\'图片未找到.\'" class="img-responsive img-thumbnail" width="150" />                        <em class="close" style="position:absolute; top: 0; right: -14px;" title="删除这张图片" @click="deleteImage(index)">×</em>                    </span>                </div>            </div>        '}),i.component("util-date",{props:["name","value"],mounted:function(){var t=this;require(["datetimepicker"],function(){n(t.$refs.date_input).datetimepicker({lang:"zh",step:5,timepicker:!0,closeOnDateSelect:!0,format:"Y-m-d H:i"})})},template:'            <input type="text" :name="name" :value="value" ref="date_input" placeholder="请选择日期时间" readonly="readonly" class="datetimepicker form-control" style="padding-left:12px;" />        '}),i.component("util-editor",{props:["name","value","image_limit","audio_limit"],mounted:function(){o.editor("editor_"+this.name,{height:"300",dest_dir:"",image_limit:1024*(this.image_limit||5),allow_upload_video:!0,audio_limit:1024*(this.audio_limit||5),callback:""})},template:'<textarea :id="\'editor_\'+name" :name="name" type="text/plain" style="height:300px;" v-model="value"></textarea>'});var j=function(e){return o.editor(e,{height:"300",dest_dir:"",image_limit:1024*(this.image_limit||5),allow_upload_video:!0,audio_limit:1024*(this.audio_limit||5),callback:""})};i.component("util-audio",{props:["name","value"],mounted:function(){this.setAudioPlayer()},methods:{show_audio:function(e){this.showAudioDialog(e.target)},showAudioDialog:function(e,t,i){var a=this,l=n(e),s=l.parent().prev(),r=s.val();o.audio(r,function(e){e&&e.attachment&&e.url&&(l.prev().show(),s.val(e.attachment),s.attr("filename",e.filename),s.attr("url",e.url),a.setAudioPlayer()),e&&e.media_id&&s.val(e.media_id)})},setAudioPlayer:function(){require(["jquery.jplayer"],function(){n(".audio-player").each(function(){n(this).prev().find("button").eq(0).click(function(){var e=n(this).parent().prev().val();n(this).find("i").hasClass("fa-stop")?n(this).parent().parent().next().jPlayer("stop"):e&&n(this).parent().parent().next().jPlayer("setMedia",{mp3:o.tomedia(e)}).jPlayer("play")})}),n(".audio-player").jPlayer({playing:function(){n(this).prev().find("i").removeClass("fa-play").addClass("fa-stop")},pause:function(e){n(this).prev().find("i").removeClass("fa-stop").addClass("fa-play")},swfPath:"resource/components/jplayer",supplied:"mp3"}),n(".audio-player-media").each(function(){n(this).next().find(".audio-player-play").css("display",""==n(this).val()?"none":"")})})}},template:'            <div>                <div class="input-group">                    <input type="text" :value="value" :name="name" class="form-control audio-player-media" autocomplete="off">                    <span class="input-group-btn">                        <button class="btn btn-default audio-player-play" type="button" style="display:none;"><i class="fa fa-play"></i></button>                        <button class="btn btn-default" type="button" @click="show_audio">选择媒体文件</button>                    </span>                </div>                <div class="input-group audio-player"></div>            </div>        '});var T=function(e){e=e||"#app";var t='            <div class="lds-dual-ring"></div>        ',i=document.createElement("div");return i.innerHTML=t,i.id="app_loading",document.querySelector(e).appendChild(i),{hide:function(t){document.querySelector(e).removeChild(i),t&&t()}}},C=function(e){var t=new i({data:e,mounted:function(){var t=this;if(this.$refs.form.action=_("save"),"ident"in l.gets){this.ident=l.gets.ident;var i=T();this.$http.get(_("detail",{ident:this.ident})).then(function(a){var n=a.data;i.hide(function(){if(0!=n.errno)return h(n.message,!1,function(){history.back()}),!1;for(var i in e)"ident"!=i&&(t[i]=n.data[i])})}).catch(function(){i.hide(function(){h("服务器异常，请稍后再试")})})}},methods:{submit:function(e){if(e.preventDefault(),!confirm("是否保存？"))return!1;var t=k(this.$refs.submit_button),i=new FormData(e.target);""!=this.ident&&i.append("ident",this.ident),this.$http.post(e.target.action,i).then(function(e){var i=e.data;0==i.errno?h(i.message,!0,function(){location.href=_("index")}):t.hide(function(){h(i.message,!1)})})}}});t.$mount("#app")};t.rgb2hex=s,t.img2base64=c,t.is_json_string=u,t.xalert=h,t.alert=h,t.vue=i,t.$=n,t.util=o,t.script={hide:function(){n("script[data-done=hide]").remove()}},t.app_url=w,t.url=_,t.loading=k,t.ban=T,t.page_script={update:C},t.sysinfo=l,t.createEditor=j});