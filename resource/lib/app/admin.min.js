define(function(require,t){var i=require("vue"),a=require("vue-resource"),n=require("jquery"),o=require("util");i.use(a),i.http.options.emulateJSON=!0;var r=window.sysinfo,l=function(e){for(var t=/[0-9]{0,3}/g,i=e.match(t),a="#",n=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F"],o=0;o<i.length;o++){for(var r=null,l=i[o],s=l,d=[];l>16;)r=l%16,l=l/16>>0,d.push(n[r]);d.push(n[l]),s<16&&""!=s&&d.push(0),a+=d.reverse().join("")}return a},s=function(e){var t=document.createElement("canvas");t.width=e.width,t.height=e.height;var i=t.getContext("2d");i.drawImage(e,0,0,e.width,e.height);var a=t.toDataURL("image/png");return a},d=function(e,t){var i=new Image;i.src=n(e).prop(t||"src"),i.onload=function(){n(e).prop("src",s(this))}},c=function(e){try{JSON.parse(e)}catch(e){return!1}return!0},u=null,p=function(e,t){if(clearTimeout(u),t=t||0,0==t)return n("#pageTip").remove(),!0;u=setTimeout(function(){n("#pageTip").remove(),e&&e()},t+300)},m=function(e,t,i){if(p(function(){i&&i(t)}),t){var a='                <div id="pageTip" class="modal fade modal-success" tabindex="-1" role="dialog" aria-hidden="true" style="display: block; padding-right: 17px;">                    <div class="modal-dialog we7-modal-dialog">                        <div class="modal-content">                            <div class="modal-body">                                <div class="text-center">                                    <i class="text-success wi wi-success-sign"></i>'+e+'                                         </div>                                          <div class="clearfix"></div>                            </div>                          </div>                    </div>                </div>            ';n("body").append(a)}else{a='                <div id="pageTip" class="modal fade modal-success" tabindex="-1" role="dialog" aria-hidden="true" style="display: block; padding-right: 17px;">                    <div class="modal-dialog we7-modal-dialog">                        <div class="modal-content" style="background-color:#a94442;border-color:#a94442">                            <div class="modal-body">                                <div class="text-center">                                    <i class="text-error wi wi-error-sign"></i>'+e+'                                         </div>                                          <div class="clearfix"></div>                            </div>                          </div>                    </div>                </div>            ';n("body").append(a)}setTimeout(function(){n("#pageTip").addClass("in")},1),p(function(){i&&i(t)},2e3)};n(".check-all-control").on("click",function(){for(var e=n(".check-all"),t=e.length,i=0;i<t;i++)if(!n(e[i]).prop("checked"))return void e.prop("checked",!0);e.prop("checked",!1)}),n(".limithigh").each(function(e,t){var i=this;if(n(this).height()<=180)return!1;n(this).css({height:120,overflow:"hidden",position:"relative"});var a=n("<div>").css({position:"absolute",bottom:"0",left:"0","z-index":"999",width:"100%",height:"80","text-align":"center","background-image":"linear-gradient(-180deg,rgba(255,255,255,0) 0%,#fff 70%)"}),o=n("<a>").prop("href","javascript:;").css({display:"inline-block","margin-top":"60px",color:"#ca0c16","font-size":"14px","text-decoration":"underline"}).text("点击显示全部").on("click",function(){n(i).css("height","auto"),a.hide()});a.append(o),n(this).append(a)});var f=function(){n("#tabtop").append('<li role="presentation"><a href="#extend" aria-controls="extend" role="tab" data-toggle="tab">扩展设置</a></li>'),n("#tabbody").append('<div role="tabpanel" class="tab-pane" id="extend">            <div class="form-group">                <label class="col-md-2 control-label text-right">页底标注文字：</label>                <div class="col-md-10">                    <input type="text" class="form-control" name="support_name" value="'+b+'">                    <p class="help-block">                        1. 实际文字显示建议15个字以内；<br>                        2. 添加超链接请输入英文符号： [link:链接文字](链接地址)，如： [link:百度一下，你就知道](https://www.baidu.com)； <br>                        3. 添加电话拨打功能请输入英文符号： [tel:电话文字](电话号)，如： [tel:中国移动](10086) <br>                        4. 文字显示请勿连续显示英文符号 []() 以及括号内的内容，它会被视为上述规则被直接替换 <br>                    </p>                </div>            </div>        </div>        ')},h=n("#tabtop li").eq(1),v=n("#tabtop li").eq(0),g=null,b=n("#tabtop").attr("data-support-name");h.on("dblclick",function(){v.on("mousedown",function(){clearTimeout(g),g=setTimeout(function(){f()},1e3)}),v.on("mouseup",function(){clearTimeout(g)}),g=setTimeout(function(){v.off("dblclick"),v.off("mousedown"),v.off("mouseup"),clearTimeout(g)},600)}),f(),n("#form_search").on("submit",function(){if("get"!=n(this).prop("method"))return!0;var e=window.location.protocol,t=window.location.host,i=window.location.pathname,a=window.location.search,o=window.location.hash,r=n(this).serializeArray(),l={};for(key in a.substr(1).split("&").forEach(function(e){e=e.split("="),l[e[0]]=e[1]}),r.forEach(function(e){l[e.name]=e.value}),a=[],l)a.push(key+"="+l[key]);a="?"+a.join("&");var s=e+"//"+t+i+a+o;return location.href=s,!1});var y=function(e,t,i){var a=e||"",n=[];for(var o in t)n.push(o+"="+encodeURI(t[o]));return a+="?"+n.join("&"),void 0!==i&&(a+="#"+i),a},x=function(e,t,i,a){var o=r.siteroot.slice(0,-1),l=(a||o)+"/app/index.php",s={i:r.acid,c:"entry",do:e,m:r.module.name};return t=t||{},e.indexOf("/")>-1?(e=e.split("/"),e[0].length>0&&(t.do=e[0]),e[1].length>0&&(t.et=e[1])):t.et=e,s=n.extend({},s,t),y(l,s,i)},w=function(e,t,i){var a="./index.php";t=t||{};var o={c:"site",a:"entry",m:r.module.name,do:r.controller_name,et:r.action_name,version_id:0};return e.indexOf("/")>-1?(e=e.split("/"),e[0].length>0&&(t.do=e[0]),e[1].length>0&&(t.et=e[1])):t.et=e,o=n.extend({},o,t),y(a,o,i)},_=function(e){var t=e.innerHTML;return e.disabled=!0,e.innerHTML='<i class="fas fa-spinner fa-spin"></i> '+t,{hide:function(i){e.disabled=!1,e.innerHTML=t,i&&i()}}};i.component("util-image",{props:["name","value"],data:function(){return{open_value:this.value}},watch:{open_value:function(e){this.$emit("value",e)}},methods:{showImageDialog:function(e){var t=this,i=n(e.target),a=i.parent().prev(),r=a.val(),l=a.parent().next().children();o.image(r,function(e){e.url&&(l.length>0&&(l.get(0).src=e.url),t.open_value=e.attachment,a.val(e.attachment),a.attr("filename",e.filename),a.attr("url",e.url)),e.media_id&&(l.length>0&&(l.get(0).src=e.url),t.open_value=e.media_id,a.val(e.media_id))},{global:!1,class_extra:"",direct:!0,multiple:!1,fileSizeLimit:512e4})},deleteImage:function(e){n(e.target).prev().attr("src","./resource/images/nopic.jpg"),n(e.target).parent().prev().find("input").val("")}},filters:{tomedia:function(e){return o.tomedia(e)}},template:'            <div>                <div class="input-group">                    <input type="text" :name="name" :value="value" class="form-control" autocomplete="off">                    <span class="input-group-btn">                        <button class="btn btn-default" type="button" @click="showImageDialog">选择图片</button>                    </span>                </div>                <div class="input-group" style="margin-top:.5em;">                    <img :src="value|tomedia" onerror="this.src=\'./resource/images/nopic.jpg\'; this.title=\'图片未找到.\'" class="img-responsive img-thumbnail" width="150" />                    <em class="close" style="position:absolute; top: 0px; right: -14px;" title="删除这张图片" @click="deleteImage">×</em>                </div>            </div>        '}),i.component("util-date",{props:["name","value"],mounted:function(){var t=this;require(["datetimepicker"],function(){n(t.$refs.date_input).datetimepicker({lang:"zh",step:5,timepicker:!0,closeOnDateSelect:!0,format:"Y-m-d H:i"})})},template:'            <input type="text" :name="name" :value="value" ref="date_input" placeholder="请选择日期时间" readonly="readonly" class="datetimepicker form-control" style="padding-left:12px;" />        '}),i.component("util-editor",{props:["name","value","image_limit","audio_limit"],mounted:function(){o.editor("editor_"+this.name,{height:"300",dest_dir:"",image_limit:1024*(this.image_limit||5),allow_upload_video:!0,audio_limit:1024*(this.audio_limit||5),callback:""})},template:'<textarea :id="\'editor_\'+name" :name="name" type="text/plain" style="height:300px;" v-model="value"></textarea>'}),i.component("util-audio",{props:["name","value"],mounted:function(){this.setAudioPlayer()},methods:{show_audio:function(e){this.showAudioDialog(e.target)},showAudioDialog:function(e,t,i){var a=this,r=n(e),l=r.parent().prev(),s=l.val();o.audio(s,function(e){e&&e.attachment&&e.url&&(r.prev().show(),l.val(e.attachment),l.attr("filename",e.filename),l.attr("url",e.url),a.setAudioPlayer()),e&&e.media_id&&l.val(e.media_id)})},setAudioPlayer:function(){require(["jquery.jplayer"],function(){n(".audio-player").each(function(){n(this).prev().find("button").eq(0).click(function(){var e=n(this).parent().prev().val();n(this).find("i").hasClass("fa-stop")?n(this).parent().parent().next().jPlayer("stop"):e&&n(this).parent().parent().next().jPlayer("setMedia",{mp3:o.tomedia(e)}).jPlayer("play")})}),n(".audio-player").jPlayer({playing:function(){n(this).prev().find("i").removeClass("fa-play").addClass("fa-stop")},pause:function(e){n(this).prev().find("i").removeClass("fa-stop").addClass("fa-play")},swfPath:"resource/components/jplayer",supplied:"mp3"}),n(".audio-player-media").each(function(){n(this).next().find(".audio-player-play").css("display",""==n(this).val()?"none":"")})})}},template:'            <div>                <div class="input-group">                    <input type="text" :value="value" :name="name" class="form-control audio-player-media" autocomplete="off">                    <span class="input-group-btn">                        <button class="btn btn-default audio-player-play" type="button" style="display:none;"><i class="fa fa-play"></i></button>                        <button class="btn btn-default" type="button" @click="show_audio">选择媒体文件</button>                    </span>                </div>                <div class="input-group audio-player"></div>            </div>        '});var k=function(e){e=e||"#app";var t='            <div class="lds-dual-ring"></div>        ',i=document.createElement("div");return i.innerHTML=t,i.id="app_loading",document.querySelector(e).appendChild(i),{hide:function(t){document.querySelector(e).removeChild(i),t&&t()}}},T=function(e){var t=new i({data:e,mounted:function(){var t=this;if(this.$refs.form.action=w("save"),"ident"in r.gets){this.ident=r.gets.ident;var i=k();this.$http.get(w("detail",{ident:this.ident})).then(function(a){var n=a.data;i.hide(function(){if(0!=n.errno)return m(n.message,!1,function(){history.back()}),!1;for(var i in e)"ident"!=i&&(t[i]=n.data[i])})}).catch(function(){i.hide(function(){m("服务器异常，请稍后再试")})})}},methods:{submit:function(e){if(e.preventDefault(),!confirm("是否保存？"))return!1;var t=_(this.$refs.submit_button),i=new FormData(e.target);""!=this.ident&&i.append("ident",this.ident),this.$http.post(e.target.action,i).then(function(e){var i=e.data;0==i.errno?m(i.message,!0,function(){location.href=w("index")}):t.hide(function(){m(i.message,!1)})})}}});t.$mount("#app")};t.RGBToHex=l,t.img2base64=d,t.isJsonString=c,t.xalert=m,t.alert=m,t.vue=i,t.$=n,t.util=o,t.script={hide:function(){n("script[data-done=hide]").remove()}},t.app_url=x,t.url=w,t.loading=_,t.ban=k,t.page_script={update:T},t.sysinfo=r});